<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1.0">
<title>Gayatri Parivar Registration</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.25/jspdf.plugin.autotable.min.js"></script>
<style>
body{margin:0;font-family:Arial,sans-serif;background:linear-gradient(135deg,#ff9a9e,#fad0c4,#fbc2eb,#a1c4fd);min-height:100vh;}
header{text-align:center;padding:20px;font-weight:bold;font-size:22px;color:#fff;text-shadow:0 2px 6px rgba(0,0,0,0.3);}
.container{ max-width:900px; margin:20px auto; background:#fff; border-radius:12px; padding:20px; box-shadow:0 8px 30px rgba(0,0,0,0.2);}
.hidden{ display:none; }
h2,h3{text-align:center;}
label{ display:block; margin-top:10px; font-size:14px; }
input,textarea,select{ width:100%; padding:8px; margin-top:4px; border:1px solid #ccc; border-radius:6px; }
textarea{ resize:vertical; }
button{ margin:10px; padding:10px 20px; border:none; border-radius:8px; background:#ff7a7a; color:#fff; font-weight:bold; cursor:pointer; }
.btn-row{ text-align:center; margin-top:20px; }
img.preview{ max-width:200px; display:block; margin:10px 0; border:1px solid #ddd; border-radius:6px; }
table{border-collapse:collapse;width:100%;margin-top:10px;}
table,th,td{border:1px solid #aaa;text-align:center;padding:5px;}
</style>
</head>
<body>
<header>WELL COME TO GAYATRI PARIVAR</header>

<!-- Home Page -->
<div class="container" id="homePage">
<h2>Choose Option</h2>
<div class="btn-row">
<button onclick="showPage('newRegPage')">New Registration</button>
<button onclick="showPage('loginPage')">Already Registered</button>
</div>
</div>

<!-- New Registration Page -->
<div class="container hidden" id="newRegPage">
<h2>New Registration</h2>
<form id="regForm">
<label>First Name*</label><input name="firstName" required>
<label>Last Name*</label><input name="lastName" required>
<label>Purpose of Living*</label><input name="purpose" required>
<label>Mobile Number*</label><input name="mobile" pattern="[0-9]{10}" required>
<label>Another Mobile Number</label><input name="mobile2" pattern="[0-9]{10}">
<label>Number of Living Members (1-4)*</label><input type="number" name="members" min="1" max="4" required>
<label>Aadhaar Number (12 digits)*</label><input name="aadhaar" pattern="[0-9]{12}" required>
<label>Official Address*</label><textarea name="address" required></textarea>
<label>Official Mobile*</label><input name="officialMobile" pattern="[0-9]{10}" required>
<label>Date of Living*</label><input type="date" name="dateLiving" required>
<label>Room Rent Per Month*</label><input type="number" name="rent" required>
<label>Advance Rupees*</label><input type="number" name="advance" required>
<label>Electric Meter Reading*</label><input type="number" name="electric" required>
<label>ID Proof (Aadhaar Image)*</label><input type="file" name="idProof" accept="image/*" required>
<label>Signature Image*</label><input type="file" name="signature" accept="image/*" required>
<div class="btn-row"><button type="submit">Register Now</button></div>
</form>
</div>

<!-- Registration Success Page -->
<div class="container hidden" id="successPage">
<h2>Registration Successful ✅</h2>
<p>Your Registration Number: <b id="regNumber"></b></p>
<div class="btn-row">
<button id="sendBtn">Send via SMS</button>
<button id="waBtn" style="background:#25d366;">Send via WhatsApp</button>
<button id="pdfBtn" style="background:#007bff;">Download PDF</button>
</div>
<div class="btn-row"><button onclick="showPage('homePage')">Back Home</button></div>
</div>

<!-- Already Registered Login -->
<div class="container hidden" id="loginPage">
<h2>Already Registered</h2>
<label>Registration Number</label><input type="text" id="loginRegNo">
<label>Password</label><input type="password" id="loginPass">
<div class="btn-row"><button onclick="login()">Login</button></div>
</div>

<!-- Details Page -->
<div class="container hidden" id="detailsPage">
<h2>Your Registration Details</h2>
<div id="detailsContent"></div>
<h3>Monthly Payment Table</h3>
<table>
<thead><tr><th>Month (Year)</th><th>Rent</th><th>Status</th></tr></thead>
<tbody id="paymentBody"></tbody>
</table>
<div class="btn-row">
<button id="pdfDetailsBtn" style="background:#007bff;">Download PDF</button>
<button onclick="showPage('homePage')">Back Home</button>
</div>
</div>

<script>
const PASSWORD="AAYUSHMANSINGH8681";
const OWNER_NUMBER="9942823314";

function showPage(id){
  document.querySelectorAll('.container').forEach(c=>c.classList.add('hidden'));
  document.getElementById(id).classList.remove('hidden');
}

function pad3(n){ return String(n).padStart(3,'0'); }

function getNextReg(){
  let last=parseInt(localStorage.getItem("lastRegNo")||"0",10);
  last++;
  localStorage.setItem("lastRegNo",last);
  return "AMSINGH"+pad3(last);
}

function fileToBase64(file){
  return new Promise((res,rej)=>{
    const r=new FileReader();
    r.onload=()=>res(r.result);
    r.onerror=()=>rej();
    r.readAsDataURL(file);
  });
}

// New Registration
document.getElementById("regForm").addEventListener("submit", async e=>{
  e.preventDefault();
  const f=new FormData(e.target);
  const data=Object.fromEntries(f.entries());
  data.firstName=data.firstName.toUpperCase();
  data.lastName=data.lastName.toUpperCase();
  const regNo=getNextReg();
  data.regNo=regNo;

  if(f.get("idProof").size>0) data.idProof=await fileToBase64(f.get("idProof"));
  if(f.get("signature").size>0) data.signature=await fileToBase64(f.get("signature"));

  localStorage.setItem("reg_"+regNo,JSON.stringify(data));

  document.getElementById("regNumber").innerText=regNo;
  showPage('successPage');

  let msg=`Registration: ${regNo}\nName: ${data.firstName} ${data.lastName}\nMobile: ${data.mobile}\nPurpose: ${data.purpose}\nRent: ${data.rent}`;
  document.getElementById("sendBtn").onclick=()=>{ window.location.href=`sms:${OWNER_NUMBER}?body=${encodeURIComponent(msg)}`; };
  document.getElementById("waBtn").onclick=()=>{ window.open(`https://wa.me/91${OWNER_NUMBER}?text=${encodeURIComponent(msg)}`,"_blank"); };
  document.getElementById("pdfBtn").onclick=()=>{ alert("PDF generation feature coming soon"); };
});

// Already Registered Login
function login(){
  const reg=document.getElementById("loginRegNo").value.trim();
  const pass=document.getElementById("loginPass").value.trim();
  if(pass!==PASSWORD){ alert("Invalid password!"); return; }
  const saved=localStorage.getItem("reg_"+reg);
  if(!saved){ alert("Registration not found!"); return; }
  const d=JSON.parse(saved);

  // Show details
  let html="";
  for(let k in d){
    if(k==="idProof"||k==="signature"){
      html+=`<p><b>${k}:</b><br><img src="${d[k]}" class="preview"/></p>`;
    }else{
      html+=`<p><b>${k}:</b> ${d[k]}</p>`;
    }
  }
  document.getElementById("detailsContent").innerHTML=html;

  // Monthly Payment Table
  const paymentBody=document.getElementById("paymentBody");
  paymentBody.innerHTML="";
  const months=["January","February","March","April","May","June","July","August","September","October","November","December"];
  months.forEach(m=>{
    const tr=document.createElement("tr");
    tr.innerHTML=`<td>${m}</td><td>${d.rent}</td><td><select><option>Not Done</option><option>Done</option></select></td>`;
    paymentBody.appendChild(tr);
  });

  showPage("detailsPage");
}
</script>
</body>
</html>